<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
x:Class="AppFitNutri.Views.ResetPasswordPage"  
xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
xmlns:viewmodels="clr-namespace:AppFitNutri.ViewModel"
BackgroundImageSource="backgroundfitnutri.png"
Title="Redefinir Senha">

    <Grid>
        <ScrollView>
            <VerticalStackLayout
                VerticalOptions="CenterAndExpand"
                HorizontalOptions="Center"
                Spacing="12">

                <!-- Logo -->
                <Image Source="logofitnutri.png"
                       WidthRequest="150"
                       HeightRequest="150"
                       Margin="0,0,0,10" />

                <!-- Título -->
                <Label Text="Redefinir Senha"
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="#13734d"
                       HorizontalTextAlignment="Center"
                       Margin="0,0,0,10" />

                <!-- Subtítulo -->
                <Label Text="Digite sua nova senha"
                       FontSize="14"
                       TextColor="#666"
                       HorizontalTextAlignment="Center"
                       Margin="0,0,0,20" />

                <!-- Token inválido -->
                <Frame HasShadow="False"
                       CornerRadius="15"
                       BackgroundColor="#f8d7da"
                       BorderColor="#f5c6cb"
                       Padding="20"
                       WidthRequest="320"
                       IsVisible="{Binding TokenValido, Converter={StaticResource BoolInverseConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="⚠️ Link Inválido"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#721c24"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Este link de redefinição de senha é inválido ou expirou."
                               TextColor="#721c24"
                               FontSize="12"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Por favor, solicite um novo link de redefinição."
                               TextColor="#721c24"
                               FontSize="12"
                               HorizontalTextAlignment="Center" />
                        <Button Text="Solicitar novo link"
                                Command="{Binding IrParaEsqueciSenhaCommand}"
                                BackgroundColor="#721c24"
                                TextColor="White"
                                CornerRadius="20"
                                Margin="0,10,0,0" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Formulário (visível apenas se token válido) -->
                <VerticalStackLayout IsVisible="{Binding TokenValido}" Spacing="12">
                    
                    <!-- Nova Senha -->
                    <Frame HasShadow="False"
                           CornerRadius="30"
                           BackgroundColor="#D3D3D3"
                           Padding="0"
                           WidthRequest="300">
                        <Entry Placeholder="Nova senha"
                               PlaceholderColor="White"
                               Text="{Binding NewPassword}"
                               IsPassword="True"
                               Margin="16,10" />
                    </Frame>

                    <!-- Confirmar Senha -->
                    <Frame HasShadow="False"
                           CornerRadius="30"
                           BackgroundColor="#D3D3D3"
                           Padding="0"
                           WidthRequest="300">
                        <Entry Placeholder="Confirmar nova senha"
                               PlaceholderColor="White"
                               Text="{Binding ConfirmPassword}"
                               IsPassword="True"
                               Margin="16,10" />
                    </Frame>

                    <!-- Requisitos da senha -->
                    <Frame HasShadow="False"
                           CornerRadius="15"
                           BackgroundColor="#f8f9fa"
                           BorderColor="#dee2e6"
                           Padding="15"
                           WidthRequest="320">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Requisitos da senha:"
                                   FontAttributes="Bold"
                                   FontSize="14"
                                   TextColor="Black" />
                            
                            <Label Text="{Binding MinLengthText}"
                                   TextColor="{Binding MinLengthColor}"
                                   FontSize="12" />
                            
                            <Label Text="{Binding LowercaseText}"
                                   TextColor="{Binding LowercaseColor}"
                                   FontSize="12" />
                            
                            <Label Text="{Binding UppercaseText}"
                                   TextColor="{Binding UppercaseColor}"
                                   FontSize="12" />
                            
                            <Label Text="{Binding NumberText}"
                                   TextColor="{Binding NumberColor}"
                                   FontSize="12" />
                            
                            <Label Text="{Binding SpecialCharText}"
                                   TextColor="{Binding SpecialCharColor}"
                                   FontSize="12" />
                            
                            <Label Text="{Binding PasswordsMatchText}"
                                   TextColor="{Binding PasswordsMatchColor}"
                                   FontSize="12" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Mensagem de sucesso -->
                    <Frame HasShadow="False"
                           CornerRadius="15"
                           BackgroundColor="#d4edda"
                           BorderColor="#c3e6cb"
                           Padding="15"
                           WidthRequest="300"
                           IsVisible="{Binding HasSuccess}">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="{Binding SuccessMessage}"
                                   TextColor="#155724"
                                   FontSize="12"
                                   HorizontalTextAlignment="Center" />
                            <Button Text="Fazer login"
                                    Command="{Binding IrParaLoginCommand}"
                                    BackgroundColor="#155724"
                                    TextColor="White"
                                    CornerRadius="20" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Mensagem de erro -->
                    <Label Text="{Binding ErrorMessage}"
                           TextColor="Red"
                           FontSize="12"
                           HorizontalTextAlignment="Center"
                           IsVisible="{Binding HasError}"
                           Margin="0,4,0,0"/>

                    <!-- Botão Redefinir (só aparece se não teve sucesso) -->
                    <Button Text="{Binding ResetButtonText}"
                            Command="{Binding RedefinirSenhaCommand}"
                            WidthRequest="300"
                            CornerRadius="30"
                            BackgroundColor="#13734d"
                            TextColor="White"
                            FontAttributes="Bold"
                            Padding="15"
                            IsEnabled="{Binding IsFormValid}"
                            IsVisible="{Binding HasSuccess, Converter={StaticResource BoolInverseConverter}}" />

                    <!-- Botão Voltar -->
                    <Button Text="← Voltar para o login"
                            Command="{Binding IrParaLoginCommand}"
                            CornerRadius="30"
                            BackgroundColor="Transparent" 
                            TextColor="#13734d"
                            FontSize="14"
                            Margin="0,10,0,0" />

                    <!-- Loading -->
                    <ActivityIndicator IsVisible="{Binding IsBusy}"
                                       IsRunning="{Binding IsBusy}"
                                       HorizontalOptions="Center"
                                       Color="#13734d" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>