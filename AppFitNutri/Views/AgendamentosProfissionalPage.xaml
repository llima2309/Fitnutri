<?xml version="1.0" encoding="utf-8"?>

<ContentPage x:Class="AppFitNutri.Views.AgendamentosProfissionalPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:AppFitNutri.ViewModel"
             xmlns:models="clr-namespace:AppFitNutri.Models"
             x:DataType="viewmodel:AgendamentosProfissionalViewModel"
             Title="Meus Agendamentos">

    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#4A90E2" Offset="0.0" />
            <GradientStop Color="#7ED321" Offset="0.5" />
            <GradientStop Color="#4A90E2" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid>
        <!-- Loading Indicator -->
        <ActivityIndicator IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Color="White"
                          VerticalOptions="Center"
                          HorizontalOptions="Center"
                          HeightRequest="50"
                          WidthRequest="50" />

        <!-- Content -->
        <RefreshView IsRefreshing="{Binding IsLoading}"
                     Command="{Binding RefreshCommand}"
                     IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ScrollView Padding="20">
                <VerticalStackLayout Spacing="16">

                    <!-- Header -->
                    <Label Text="Meus Agendamentos"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="White"
                           Margin="0,0,0,16">
                        <Label.Shadow>
                            <Shadow Brush="#000" Offset="0,2" Radius="4" Opacity="0.3" />
                        </Label.Shadow>
                    </Label>

                    <!-- Empty State -->
                    <VerticalStackLayout Spacing="16"
                                        IsVisible="{Binding HasAgendamentos, Converter={StaticResource InverseBoolConverter}}"
                                        VerticalOptions="CenterAndExpand"
                                        Padding="20">
                        <Border BackgroundColor="White"
                                StrokeShape="RoundRectangle 20"
                                Padding="40">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,4" Radius="8" Opacity="0.15" />
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                                <Label Text="ðŸ“…"
                                       FontSize="64"
                                       HorizontalOptions="Center" />
                                <Label Text="Nenhum agendamento"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       TextColor="#333"
                                       HorizontalTextAlignment="Center" />
                                <Label Text="VocÃª nÃ£o possui agendamentos no momento"
                                       FontSize="14"
                                       TextColor="#666"
                                       HorizontalTextAlignment="Center" />
                            </VerticalStackLayout>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Agendamentos List -->
                    <CollectionView ItemsSource="{Binding Agendamentos}"
                                   IsVisible="{Binding HasAgendamentos}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:AgendamentoDto">
                                <Border BackgroundColor="White"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="20"
                                        Margin="0,0,0,16">
                                    <Border.Shadow>
                                        <Shadow Brush="Black" Offset="0,4" Radius="8" Opacity="0.15" />
                                    </Border.Shadow>
                                    <Grid RowSpacing="12">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- Paciente -->
                                        <HorizontalStackLayout Grid.Row="0" Spacing="12">
                                            <Border BackgroundColor="#E3F2FD"
                                                    StrokeShape="RoundRectangle 12"
                                                    Padding="10"
                                                    WidthRequest="48"
                                                    HeightRequest="48">
                                                <Label Text="ðŸ‘¤"
                                                       FontSize="24"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center" />
                                            </Border>
                                            <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                                                <Label Text="{Binding ProfissionalNome, FallbackValue='Paciente'}"
                                                       FontSize="18"
                                                       FontAttributes="Bold"
                                                       TextColor="#333" />
                                                <Label Text="Paciente"
                                                       FontSize="12"
                                                       TextColor="#666" />
                                            </VerticalStackLayout>
                                        </HorizontalStackLayout>

                                        <!-- Data e Hora -->
                                        <Grid Grid.Row="1" ColumnSpacing="16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <HorizontalStackLayout Grid.Column="0" Spacing="8">
                                                <Label Text="ðŸ“…"
                                                       FontSize="16"
                                                       VerticalOptions="Center" />
                                                <Label Text="{Binding Data, StringFormat='{0:dd/MM/yyyy}'}"
                                                       FontSize="14"
                                                       TextColor="#333"
                                                       VerticalOptions="Center" />
                                            </HorizontalStackLayout>

                                            <HorizontalStackLayout Grid.Column="1" Spacing="8">
                                                <Label Text="ðŸ•"
                                                       FontSize="16"
                                                       VerticalOptions="Center" />
                                                <Label Text="{Binding Hora, StringFormat='{0:HH:mm}'}"
                                                       FontSize="14"
                                                       TextColor="#333"
                                                       VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <!-- Status -->
                                        <Border Grid.Row="2"
                                                BackgroundColor="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                                StrokeShape="RoundRectangle 8"
                                                Padding="12,8"
                                                HorizontalOptions="Start">
                                            <Label Text="{Binding Status, Converter={StaticResource StatusToTextConverter}}"
                                                   FontSize="12"
                                                   TextColor="White"
                                                   FontAttributes="Bold" />
                                        </Border>

                                        <!-- AÃ§Ãµes -->
                                        <Grid Grid.Row="3" ColumnSpacing="12" RowSpacing="8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!-- BotÃ£o Confirmar (apenas se status = Pendente) -->
                                            <Button Grid.Row="0" Grid.Column="0"
                                                    Text="âœ“ Confirmar"
                                                    BackgroundColor="#4CAF50"
                                                    TextColor="White"
                                                    FontSize="14"
                                                    FontAttributes="Bold"
                                                    Padding="12,8"
                                                    CornerRadius="8"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:AgendamentosProfissionalViewModel}}, Path=ConfirmarCommand}"
                                                    CommandParameter="{Binding .}"
                                                    IsVisible="{Binding Status, Converter={StaticResource StatusIsPendenteConverter}}" />

                                            <!-- BotÃ£o Cancelar -->
                                            <Button Grid.Row="0" Grid.Column="1"
                                                    Text="âœ• Cancelar"
                                                    BackgroundColor="#F44336"
                                                    TextColor="White"
                                                    FontSize="14"
                                                    FontAttributes="Bold"
                                                    Padding="12,8"
                                                    CornerRadius="8"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:AgendamentosProfissionalViewModel}}, Path=CancelarCommand}"
                                                    CommandParameter="{Binding .}"
                                                    IsVisible="{Binding Status, Converter={StaticResource StatusIsNotCanceladoConverter}}" />

                                            <!-- BotÃ£o Videochamada (apenas se status = Confirmado) -->
                                            <Button Grid.Row="1" Grid.ColumnSpan="2"
                                                    Text="ðŸŽ¥ Iniciar Videochamada"
                                                    BackgroundColor="#2196F3"
                                                    TextColor="White"
                                                    FontSize="14"
                                                    FontAttributes="Bold"
                                                    Padding="12,8"
                                                    CornerRadius="8"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:AgendamentosProfissionalViewModel}}, Path=IniciarChamadaCommand}"
                                                    CommandParameter="{Binding .}"
                                                    IsVisible="{Binding IsConfirmado}" />
                                        </Grid>

                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
    </Grid>

</ContentPage>

